<!DOCTYPE html>
<HTML lang="en">
	<head>
		<meta charset="utf-8"> 
		<!-- Latest compiled and minified CSS -->	
		<link rel="stylesheet" type="text/css" href="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css"/>
		<link rel="stylesheet" type="text/css" href="style.css"/>
		<!-- jQuery library -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
		<!-- D3 library -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.16/d3.js"></script>
		<!-- Latest compiled JavaScript -->
		<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
		<!-- Mobile-first -->
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<!--fancybox css!-->
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.css" type="text/css" media="screen" />
		<!--fancybox javascript!-->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.js"></script>
		<title>UI Telemetry</title>
	</head>
	<body>
		<script type="text/javascript">

			var csvData = [];

			//gets URL parameters
			function getParameters(){
				
				url = window.location.href;

				var parameters = [];

				if(/week=([^&]+)/.exec(url))
					parameters['week'] = /week=([^&]+)/.exec(url)[1];
				if(/week2=([^&]+)/.exec(url))
					parameters['week2'] = /week2=([^&]+)/.exec(url)[1];
				
				if(/version=([^&]+)/.exec(url))	
	    			parameters['version'] = /version=([^&]+)/.exec(url)[1];
	    		if(/channel=([^&]+)/.exec(url))
	    			parameters['channel'] = /channel=([^&]+)/.exec(url)[1];
	    		
	    		//version toggle will be true or false to later version comparision
	    		if(/version_toggle=([^&]+)/.exec(url))
	    			parameters['version_toggle'] = /version_toggle=([^&]+)/.exec(url)[1];

	    		//show only from a certain os
	    		if(/os=([^&]+)/.exec(url))
	    			parameters['os'] = /os=([^&]+)/.exec(url)[1];

	    		//if are set, will show only from determined filters or categories
	    		if(/filter=([^&]+)/.exec(url))
	    			parameters['filter'] = /filter=([^&]+)/.exec(url)[1];
	    		if(/uicategory=([^&]+)/.exec(url))
	    			parameters['uicategory'] = /uicategory=([^&]+)/.exec(url)[1];

	    		//sortby parameters on GUI build
	    		if(/sortby=([^&]+)/.exec(url))
	    			parameters['sortby'] = /sortby=([^&]+)/.exec(url)[1];
	 
	    		return parameters;
			}

			//this method populates an array with a given week 
			function populateFeatures(){

				var parameters = getParameters();

				var docname = parameters['week'] + "_" + parameters['version'] + "_" + parameters['channel'] + ".csv";

			   var myData = [];

		    	var xmlhttp = null;
			    xmlhttp = new XMLHttpRequest();
			    xmlhttp.open( "GET", docname, false );
			    xmlhttp.send( null );
			    return d3.csv.parse(xmlhttp.responseText);
			   

			}

			function filterData(var parsedData, var filters){
				var filteredData = [];
				for (i = 0; i < parsedData.length; i++) { 
					
					//filters os
					if(!filters['os']){
						filteredData.push(parsedData[i]);
						continue;
					}else{
						if(parsedData[i]['os'] == filters['os'])
							filteredData.push(parsedData[i]);
						else
							continue;
					}
				}
			}

			//this function closes the initial panel data from general Telemetry
			function closeFront(){
				$("#initialheader").fadeOut(400);		
			}

			
			//loads fancybox
			$(".fancybox").fancybox();
			
			//changes the MenuOptions state
			function changeMenuTab(){

			}

			//this function initializes the dashboard.
			function initDash(){

				//populates an array with all given values extracted from the csv
				var features = populateFeatures();
				filteredFeatures = filter()
				
				//build the GUI for the dashboard
				//createGUI(features);

			}

			initDash();

		</script>

		<div class="container containerwrap">
			
			<div class="row centertext" id="headerrow"/>
				<h1>UI Telemetry</h1>
				<p>Measured days: Weeks 2/8/2016 to 2/14/2016 on all OS</p>

				<div id="initialheader">
					<p class="closetext" onClick="closeFront()">[x]</p>

					<h3>UI Telemetry Usage Stats</h3>

					<h4>Number of measured users:</h4>
					<h4>Number or users per OS:</h4>
					<h4>Number of measured sessions:</h4>
					<h4>Average sessions per user:</h4>
					<h4></h4>
				</div>
			</div>
			<div class="row">
				<div class="col-sm-3">
					<h3>Options</h3>

					<div id="optionstabs">

					</div>
				</div>
				<div class="col-sm-9">
					<h3>Features</h3>
				</div>
			</div>
			<div class="row">
				<div class="col-sm-3" id="optionsmenu">

					<ul class="nav nav-pills">
						<li id="optionsmenu" class="active"><a href="#">Options</a></li>
  						<li id="featuresmenu"><a href="#">Features</a></li>
  					</ul>

  					<div id="filterform">
  						<form>
  						</form>
  					</div>
				</div>

				<div id="contentpanel" class="col-sm-9">
					<h3>clicks <a data-toggle="collapse" href="#clicksset">+</a> </h3>
						<!--set of itens under clicksset category!-->

						<div id="clicksset" class="collapse">
								<!--character encoding button items!-->

								<!--Character Encoding Clicks !-->
								<div id="characterencodingbtnclicks"class="featureitem">
									<h4>characterencoding-btn <a href="#characterencodingbtnclicksdesc" class="fancybox">
										<small>learn more</small></a></h4>

									<div id="visualization"></div>	
									<!--description of the feature!-->
									<div style="display: none">
										<div id="characterencodingbtnclicksdesc">Some content here</div>
									</div>
								</div>

								<!--Email Link Button Clicks !-->
								<div id="emaillinkbtnclicks" class="featureitem">
									<h4>emaillinkbtn <a href="#emaillinkbtnclicksdesc" class="fancybox"><small>learn more</small></a></h4>
									<!--description of the feature!-->
									<div style="display: none">
										<div id="emaillinkbtnclicksdesc">Some content here</div>
									</div>
								</div>

								<!--Email Link Button Clicks !-->
								<div id="emaillinkbtnclicks" class="featureitem">
									<h4>emaillinkbtn <a href="#emaillinkbtnclicksdesc" class="fancybox"><small>learn more</small></a></h4>
									<!--description of the feature!-->
									<div style="display: none">
										<div id="emaillinkbtnclicksdesc">Some content here</div>
									</div>
								</div>

								<!--Email Link Button Clicks !-->
								<div id="emaillinkbtnclicks" class="featureitem">
									<h4>emaillinkbtn <a href="#emaillinkbtnclicksdesc" class="fancybox"><small>learn more</small></a></h4>
									<!--description of the feature!-->
									<div style="display: none">
										<div id="emaillinkbtnclicksdesc">Some content here</div>
									</div>
								</div>
 
								<!--Email Link Button Clicks !-->
								<div id="emaillinkbtnclicks" class="featureitem">
									<h4>emaillinkbtn <a href="#emaillinkbtnclicksdesc" class="fancybox"><small>learn more</small></a></h4>
									<!--description of the feature!-->
									<div style="display: none">
										<div id="emaillinkbtnclicksdesc">Some content here</div>
									</div>
								</div>

								<!--Email Link Button Clicks !-->
								<div id="emaillinkbtnclicks" class="featureitem">
									<h4>emaillinkbtn <a href="#emaillinkbtnclicksdesc" class="fancybox"><small>learn more</small></a></h4>
									<!--description of the feature!-->
									<div style="display: none">
										<div id="emaillinkbtnclicksdesc">Some content here</div>
									</div>
								</div>

								<!--Email Link Button Clicks !-->
								<div id="emaillinkbtnclicks" class="featureitem">
									<h4>emaillinkbtn <a href="#emaillinkbtnclicksdesc" class="fancybox"><small>learn more</small></a></h4>
									<!--description of the feature!-->
									<div style="display: none">
										<div id="emaillinkbtnclicksdesc">Some content here</div>
									</div>
								</div>

								<!--Email Link Button Clicks !-->
								<div id="emaillinkbtnclicks" class="featureitem">
									<h4>emaillinkbtn <a href="#emaillinkbtnclicksdesc" class="fancybox"><small>learn more</small></a></h4>
									<!--description of the feature!-->
									<div style="display: none">
										<div id="emaillinkbtnclicksdesc">Some content here</div>
									</div>
								</div>

						</div>


					<h3>customizations <a data-toggle="collapse" href="#customizationsset">+</a> </h3>
						<!--set of itens under customizations category!-->

						<div id="customizationsset" class="collapse">
								<!--character encoding button items!-->
								<div id="characterencodingbtn" class="featureitem">
									<h4>characterencoding-btn <a href="#featurename" class="fancybox">+</a></h4>
									<!--description of the feature!-->
									<div style="display: none">
										<div id="featurename">Some content here</div>
									</div>
								</div>
						</div>
					<h3>screen sizes <a class="fancybox" href="">+</a> </h3>
					

					<h3>stats <a class="fancybox" href="">+</a> </h3>
					
					<h3>toolbars <a class="fancybox" href="">+</a> </h3>
					

					<h3>unspecified <a class="fancybox" href="">+</a> </h3>
				</div>
					
			</div>
		</div>
	</body>
</HTML>